<h2>Моя история заказов</h2>

<div *ngIf="loading" class="loading-indicator">Загрузка...</div>

<div *ngIf="error && !loading" class="error-message">
  <p><strong>Ошибка:</strong> {{ error }}</p>
  <button (click)="retryLoad()" class="btn-retry">Попробовать снова</button>
</div>

<ng-container *ngIf="!loading && !error">
  <ng-container *ngIf="orders$ | async as orders">
    <div *ngIf="orders.length > 0; else noOrdersTemplate">
      <div *ngFor="let order of orders" class="order-card">
        <div class="order-header">
          <h3>Заказ #{{ order.id }}</h3>
          <span>от {{ order.date_ordered | date : "dd.MM.yyyy HH:mm" }}</span>
        </div>
        <div class="order-summary">
          <strong>Сумма:</strong>
          {{ order.total_order_price | currency : "KZT" : "symbol" : "1.2-2" }}
        </div>
        <div class="order-items" *ngIf="order.items?.length">
          <h4>Товары:</h4>
          <ul class="item-list">
            <li *ngFor="let item of order.items" class="order-item">
              <span class="item-name">{{ item.product_name }}</span>
              <span class="item-details">
                {{ item.quantity }} x
                {{ item.price | currency : "KZT" : "symbol" : "1.2-2" }}
              </span>
              <span class="item-total">
                =
                {{
                  item.total_item_price | currency : "KZT" : "symbol" : "1.2-2"
                }}
              </span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </ng-container>
</ng-container>

<ng-template #noOrdersTemplate>
  <div class="no-orders">
    <p>У вас еще нет заказов.</p>
    <a routerLink="/" class="btn-link">К покупкам</a>
  </div>
</ng-template>
